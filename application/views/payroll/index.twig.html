{% extends "layout/main.twig.html" %}

{% block content %}
<div class="row">
    <section class="col-md-12 connectedSortable ui-sortable">
        <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
                <li class="active"><a href="/payroll" data-toggle="tab">Payroll</a></li>
                <li ><a href="/payroll/payslip">Payslip</a></li>

             <!--    <li ><a href="/payroll/gov-form" >Gov. Form</a></li>
                <li ><a href="/payroll/bank">Bank</a></li> -->

            </ul>
            <div class="tab-content no-padding ">
                <!-- bir tax table -->
                <div class="tab-pane active" id="payroll" style="position: relative; height: 300px;">

                	<div class="box">
                                <div class="box-header">
                                    <h3 class="box-title"></h3>
                                </div><!-- /.box-header -->
                                <div class="box-body">
                                	<a data-toggle="modal" data-target="#generate-modal" class="btn btn-primary fa fa-plus ">&nbsp; Generate Payroll</a>
                                </div>
                                <div class="box-body table-responsive">
                                    <table id="example1" class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Payroll Group</th>
                                                <th>Period</th>
                                                <th>From</th>
                                                <th>To</th>
                                                <th>Branch</th>
                                                <th>Detail</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                           
                                           	{% for group in payroll %}
                                           	 <tr>
                                           		<td>{{ group.getGroupName() }}</td>
                                           		<td>{{ group.getGroupPeriod() }}</td>
                                           		<td>{{ group.from }}</td>
                                           		<td>{{ group.to }}</td>
                                           		<td>{{ group.getBranch() }}</td>
                                           		<td>		</td>
                                            </tr>
                                           	{% endfor %}
                                           
                                            </tfoot>
                                    </table>
                                </div><!-- /.box-body -->
                            </div><!-- /.box -->

                </div>
                <!-- sss table -->
            </div>
        </div>
	</section>
</div>



<div class="modal fade" id="generate-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				
					<div class="modal-header">Generate Payroll</div>
					<div class="modal-body">
						<div class="form-group">

		                    <label>Payroll Group</label>
		                    <select class="form-control" id="group_name">
		                      {% for group in payrollgroup %}
		                      	<option value="{{ group.id }}"> {{ group.group_name }}</option>
		                      {% endfor %}
		                    </select>
		                </div>
		                <div class="form-group">
	                        <label>Payroll date:</label>
	                        <div class="input-group">
	                            <div class="input-group-addon">
	                                <i class="fa fa-clock-o"></i>
	                            </div>
	                            <input type="text" class="form-control pull-right" placeholder="must choose date range" id="payrolltime">
	                        </div>
	                    </div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary" id="generate-payroll" >Generate</button>
						<button class="btn"  data-dismiss="modal" >close</button>
					</div>
				
			</div>
		</div>
</div>
<!-- plugins -->
<script type="text/javascript"  src="/js/plugins/daterangepicker/daterangepicker.js" ></script>
<script type="text/javascript">
	(function($){
		var alerttpl = '<div class="alert alert-info alert-dismissable"> '+
	                        '<i class="fa fa-ban"></i> '+
	                        '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>'+
	                        '<b></b> Loading...'+
	                   '</div>'; 

		$('#payrolltime').daterangepicker({
			'endDate': parseInt(moment().format('DD'))>15 ? moment().format('MM')+'-30-'+moment().format('YYYY') :  moment().format('MM')+'-15-'+moment().format('YYYY') 
				});
		$('.applyBtn').click(function(){

			 var start = moment($('.daterangepicker_start_input input').val()).format('MM-DD-YYYY'),
					end   = moment($('.daterangepicker_end_input input').val()).format('MM-DD-YYYY');
					console.log(end);
				$('#generate-payroll').on('click',function(){

					var group_name = $('#group_name').val();

					var data = {
						'group_name' : group_name,
						'start' : start,
						'end'   : end
					};

					$('#generate-modal .modal-body').prepend(alerttpl);
					$.post('/payroll/payslip/generate',data,function(res){
					}).success(function(){
						$('#payrolltime').val('')
						$('#generate-modal').modal('hide')
						
						window.location.reload();
					});

				});
			
		 });

	})(jQuery);
</script>


{% endblock %}
