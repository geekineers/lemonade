{% extends "layout/main.twig.html" %} {% block content %}
<div class="row">
    <div class="col-md-2">
        <a data-toggle="modal" data-target="#addTimesheet" class=" btn btn-success" href="#addTimesheet btn-sm"><i class="fa fa-plus"></i></a>
        <a data-toggle="modal" data-target="#uploadTimesheet" class="btn btn-default btn-sm"><i class="fa fa-file"></i>Upload Sheet</a>
    </div>
<div class="col-md-5">
    <div class="form-group">
    <div class="input-group">
        <input type="text" name="q" id="query" class="form-control" placeholder="Search...">
        <span class="input-group-btn">
            <button type="submit" name="seach" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
            </button>
        </span>
    </div>
</div>
</div>
    <div class="col-md-5 ">
       
        <div class="form-inline pull-right">
            <div class="form-group">

                <input type="" id="dateranger-from" name="from" class="form-control datepicker" placeholder="From" >
            </div>
            <div class="form-group">

                <input type="" id="dateranger-to" name="to" class="form-control datepicker" placeholder="To" >
            </div>
            <div class="form-group">
                <a href="#" class="btn btn-default dateranger-btn"><i class="fa fa-search"></i></a>
            </div>
        </div>
    </div>

</div>

<table id="timesheet1" class="table table-bordered table-hover dataTable">
   <thead>
    <tr>
        <th>Time In</th>
        <th>Time Out</th>
        <th>Name</th>
        <th>Emp. ID</th>
     
        <th>Status</th>
        <th>Options</th>
    </tr>
   </thead>
   <tbody>
    {% for time in timesheets %}
    <tr >
        <td>{{ time.time_in }}</td>
        <td>{{ time.getTimeOut() }}</td>
        <td>{{ time.getEmployee.getName() }}</td>
        <td>{{ time.getEmployee.getEmployeeId() }}</td>
        <td>{{ time.getTimeDiff() }} - 
        {% if time.checkIfUndertime() %}<span class="label label-danger">Under Time</span>
        {% elseif time.checkIfEmployeeDeleted() %}
            <span class="label label-default">Terminated</span>
        {% else %}
            <span class="label label-success">Good</span>
        {% endif %}
        </td>
    
        <td>
            <a href="#" 
            data-id = "{{ time.id }}"
            data-employee-name="{{ time.getEmployee.getName() }}" 
            data-employee-id="{{ time.getEmployee.id }}" 
            data-time-in="{{ time.time_in }}" 
            data-time-out="{{ time.time_out }}" 

            class="btn btn-primary edit-timesheet"><i class="fa fa-edit"></i></a>
              <a  onclick="return confirm('Are you sure?')"  href="/timesheet/delete?token={{ time.id }}" class="btn btn-danger"><i class="fa fa-trash-o"></i></a>
        </td>
    </tr>

    {% endfor %}       
   </tbody>

</table>



<form method="post" id="form-add-timesheet" action="/timesheet/save">
    <div class="modal fade" id="addTimesheet" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">Add Timesheet</h4>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label>Employee Name</label>
                        <select required name="employee" class="form-control combobox employee-sched">
                            {% for employee in employees %}
                            <option></option>
                            <option data-timestart="{{ employee.getTimeShiftStart() }}" data-timeend="{{ employee.getTimeShiftEnd() }}" value="{{ employee.id }}">{{ employee.getName() }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Time In</label>
                        <div class="input-group edit-time bootstrap-timepicker" style="visibility: visible;">
                            <input id="timestart" type="text" name="timestart" class="timepicker form-control input-small">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Time Out</label>
                        <div class="input-group edit-time bootstrap-timepicker" style="visibility: visible;">
                            <input id="timeend" type="text" name="timeend" class="timepicker form-control input-small">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Schedule</label>
                        <div class="form-inline">
                            <div class="form-group">

                                <input required type="" name="from" class="form-control datepicker" placeholder="From" id="evaluation-from">
                            </div>
                            <div class="form-group">

                                <input required type="" name="to" class="form-control datepicker" placeholder="To" id="evaluation-from">
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Save" />
                </div>
            </div>
        </div>
    </div>

</form>


<form method="post" action="/timesheet/update">
    <div class="modal fade" id="updateTimesheet" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">Add Timesheet</h4>
                </div>
                <div class="modal-body">
                <input type="hidden" name="timesheet_id" id="updatetimesheet_id" />
                    <div class="form-group">
                        <label>Employee Name</label>
                        <select name="employee" readonly id="updatetimesheet_employee" class="form-control employee-sched">
                            {% for employee in employees %}
                            <option></option>
                            <option data-timestart="{{ employee.getTimeShiftStart() }}" data-timeend="{{ employee.getTimeShiftEnd() }}" value="{{ employee.id }}">{{ employee.getName() }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Time In</label>
                        <div class="input-group edit-time bootstrap-timepicker" style="visibility: visible;">
                            <input required id="updatetimesheet_timestart" type="text" name="timestart" class="timepicker form-control input-small">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Time Out</label>
                        <div class="input-group edit-time bootstrap-timepicker" style="visibility: visible;">
                            <input required id="updatetimesheet_timeend" type="text" name="timeend" class="timepicker form-control input-small">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Schedule</label>
                        <div class="form-inline">
                            <div class="form-group">

                                <input required type="" name="from" class="form-control datepicker" placeholder="From" id="updatetimesheet_from">
                            </div>
                            <div class="form-group">

                                <input required type="" name="to" class="form-control datepicker" placeholder="To" id="updatetimesheet_to">
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Save" />
                </div>
            </div>
        </div>
    </div>

</form>


<form method="post" enctype="multipart/form-data" action="/timesheet/upload">
<div class="modal fade" id="uploadTimesheet" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">Upload XLS Timesheet</h4>
                </div>
                <div class="modal-body">
                    <p>Get the timsheet template. <a href="/xls_template/timesheet.xlsx">Click Here</a></p>
                    <div class="form-group">
                        <label>Upload Excel File</label>
                        <input type="file" required name="excel_file" class="form-control" />
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Save" />
                </div>
            </div>
        </div>
    </div>
</form>





{% endblock %} 
{% block scripts %}
<script type="text/javascript" src="/js/plugins/datatables/jquery.dataTables.js"></script>
<script type="text/javascript">

$('#form-add-timesheet').on('submit', function(e){
    if($('#updatetimesheet_employee').val() == 0){
        alert('Select an Employee First');
        e.preventDefault();
    }
});

$('#query').on('keyup', function(e){
    e.preventDefault();
    var query = $('#query').val();
    var from = $('#dateranger-from').val();
    var to = $('#dateranger-to').val();

    if(from == null && to == null){
        alert('Kindly input date range');
    }
    else{
        $.get('/timesheet/range', {query:query, from : from, to : to}, function(resp){
            $('.dataTable').html(resp);
        });

    }

});

$('.dateranger-btn').on('click', function(e){
    e.preventDefault();
    var query = $('#query').val();
    var from = $('#dateranger-from').val();
    var to = $('#dateranger-to').val();

    if(from == null && to == null){
        alert('Kindly input date range');
    }
    else{
        $.get('/timesheet/range', {query:query, from : from, to : to}, function(resp){
            $('.dataTable').html(resp);
        });

    }

});

$('.edit-timesheet').on('click', function(e){
    e.preventDefault();
    var timesheet_id = $(this).data('id');
    var employee_name = $(this).data('employee-name'); 
    var employee_id = $(this).data('employee-id'); 
    var time_in = $(this).data('time-in'); 
    var time_out = $(this).data('time-out'); 

    var date_from = new Date(time_in);
    var date_to = new Date(time_out);
    $("#updatetimesheet_employee > option").each(function() {
    $this = $(this);
      if(this.value == employee_id){
       
        $this.attr('selected', 'selected');
      }
    });



    var from = date_from.getFullYear() + "-" + date_from.getMonth() + "-" + date_from.getDate();

    var to = date_to.getFullYear() + "-" + date_to.getMonth() + "-" + date_to.getDate();


    var timein = getHours(date_from.getHours()) + ":" + date_from.getMinutes() + " " + getDD(date_from.getHours());

    var timeout = getHours(date_to.getHours()) + ":" + date_to.getMinutes() + " " + getDD(date_to.getHours());


    $('#updatetimesheet_id').val(timesheet_id);
    $('#updatetimesheet_timestart').val(timein);
    $('#updatetimesheet_timeend').val(timeout);
    $('#updatetimesheet_from').val(from);
    $('#updatetimesheet_to').val(to);

    $('#updateTimesheet').modal('show');
});

function getDD(h)
{
    dd = "AM";
    if (h >= 12) {
        h = h-12;
        dd = "PM";
    }
    if (h == 0) {
        h = 12;
    }

    return dd;
}

function getHours(h){
     if (h >= 12) {
        h = h-12;
      
    }
    if (h == 0) {
        h = 12;
    }

    return h;
}

    (function($){
        $('#timesheet1').dataTable({
            "bPaginate": true,
            "bFilter": false,
            "bSort": false,
            "bInfo": true,
            "bAutoWidth": true
        });

        $('.dataTables_paginate > a').addClass('btn btn-default');
    })(jQuery);
</script>

{% endblock %}
